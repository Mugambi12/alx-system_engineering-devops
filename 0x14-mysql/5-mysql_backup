#!/usr/bin/env bash
# A Bash script to archive all MySQL databases with the help of mysqldump and tar.

# Check if the correct number of arguments is provided
if [ "$#" -ne 1 ]; then
    echo "Usage: $0 <mysql_root_password>"
    exit 1
fi

# Define variables
mysql_password="$1"
timestamp=$(date +%d-%m-%Y)
dumpfile="backup.sql"
archive="backup_$timestamp.tar.gz"

# Generate MySQL dump
mysqldump -uroot -p$mysql_password --all-databases > $dumpfile

# Check if MySQL dump was successful
if [ $? -ne 0 ]; then
    echo "Error: MySQL dump failed. Please check your MySQL credentials."
    exit 1
fi

# Compress the dump file
tar -czf $archive $dumpfile

# Check if compression was successful
file $archive | grep -q "gzip compressed data"
if [ $? -ne 0 ]; then
    echo "Error: Compression failed. Please check your tar and gzip installation."
    exit 1
fi

# Clean up temporary dump file (uncomment if desired)
# rm $dumpfile

# Display success message
echo "Backup completed successfully!"
